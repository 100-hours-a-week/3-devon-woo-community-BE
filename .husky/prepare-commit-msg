#!/usr/bin/env bash

COMMIT_MESSAGE_FILE_PATH=$1
first_line=$(head -n1 "$COMMIT_MESSAGE_FILE_PATH")
remaining_lines=$(tail -n +2 "$COMMIT_MESSAGE_FILE_PATH")

# ì´ë¯¸ ì´ëª¨ì§€+íƒ€ìž… í˜•ì‹ìœ¼ë¡œ ì €ìž¥ëœ ì»¤ë°‹(ì˜ˆ: amend)ì´ë©´ ê±´ë„ˆëœë‹ˆë‹¤.
if [[ "$first_line" =~ ^(âœ¨\ feat|ðŸ›\ fix|âš¡\ perf|â™»ï¸\ refactor|ðŸ§ª\ test|ðŸ“\ docs|ðŸŽ¨\ style|ðŸ”§\ chore|ðŸš€\ delopy|âª\ revert) ]]; then
  exit 0
fi

# Gitì´ ìžë™ ìƒì„±í•˜ëŠ” ë©”ì‹œì§€ëŠ” ì˜ˆì™¸ ì²˜ë¦¬
if [[ $first_line =~ ^(Merge|Revert|Amend|Reset|Rebase|Tag) ]]; then
  exit 0
fi

type=$(echo "$first_line" | grep -o "^[A-Za-z]*")
normalized_type="$(echo "$type" | tr 'A-Z' 'a-z')"

emoji=""
case "$normalized_type" in
  feat)   emoji="âœ¨" ;;
  fix)    emoji="ðŸ›" ;;
  perf)   emoji="âš¡" ;;
  refactor) emoji="â™»ï¸" ;;
  test)   emoji="ðŸ§ª" ;;
  docs)   emoji="ðŸ“" ;;
  style)  emoji="ðŸŽ¨" ;;
  chore)  emoji="ðŸ”§" ;;
  delopy) emoji="ðŸš€" ;;
  revert) emoji="âª" ;;
  *)      emoji="" ;;
esac

# ìœ íš¨í•˜ì§€ ì•Šì€ íƒ€ìž…ì´ë©´ ì»¤ë°‹ì„ ë§‰ê³  ê°€ì´ë“œë¥¼ ì¶œë ¥
if [[ -z "$emoji" || -z "$normalized_type" ]]; then
  echo "â›” ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì»¤ë°‹ íƒ€ìž…ìž…ë‹ˆë‹¤."
  echo "   ì‚¬ìš© ê°€ëŠ¥í•œ íƒ€ìž…:"
  echo "     feat, fix, perf, refactor, test, docs, style, chore, delopy, revert"
  echo "   ì˜ˆ) feat: ê¸°ëŠ¥ ì¶”ê°€ ì„¤ëª…"
  exit 1
fi

# ì²« ë²ˆì§¸ ë‹¨ì–´ë¥¼ 'ì´ëª¨ì§€ + íƒ€ìž…(ì†Œë¬¸ìž)' ë¡œ ë³€í™˜
first_line=$(echo "$first_line" | sed "s/^$type/$emoji $normalized_type/")

# (ì„ íƒ) ë¸Œëžœì¹˜ ì´ë¦„ì´ í•„ìš”í•˜ë©´ ì•„ëž˜ ë³€ìˆ˜ ì‚¬ìš© ê°€ëŠ¥
branch_name=$(git rev-parse --abbrev-ref HEAD)
# í˜„ìž¬ ì˜ˆì‹œëŠ” branch_name ì€ ì‚¬ìš©í•˜ì§€ ì•Šê³ , í•„ìš”ì‹œ ê·œì¹™ í™•ìž¥ì— í™œìš©.

echo "$first_line" > "$COMMIT_MESSAGE_FILE_PATH"
echo "$remaining_lines" >> "$COMMIT_MESSAGE_FILE_PATH"
