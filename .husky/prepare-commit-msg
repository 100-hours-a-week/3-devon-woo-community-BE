#!/usr/bin/env bash
. "$(dirname -- "$0")/_/husky.sh"

emojies=(
  "Feat âœ¨"
  "Fix ðŸ›"
  "Style â­ï¸"
  "Refactor â™»ï¸"
  "File ðŸ“"
  "Test âœ…"
  "Docs ðŸ“"
  "Remove ðŸ”¥"
  "Ci ðŸ’š"
  "Release ðŸ”–"
  "Chore ðŸ”§"
)

COMMIT_MESSAGE_FILE_PATH=$1
first_line=$(head -n1 "$COMMIT_MESSAGE_FILE_PATH")
remaining_lines=$(tail -n +2 "$COMMIT_MESSAGE_FILE_PATH")

# Gitì´ ìžë™ ìƒì„±í•˜ëŠ” ë©”ì‹œì§€ëŠ” ì˜ˆì™¸ ì²˜ë¦¬
if [[ $first_line =~ ^(Merge|Revert|Amend|Reset|Rebase|Tag) ]]; then
  exit 0
fi

type=$(echo "$first_line" | grep -o "^[A-Za-z]*")
start_case_type="$(echo "$type" | awk '{print toupper(substr($0,1,1)) tolower(substr($0,2))}')"

emoji=""
for entry in "${emojies[@]}"; do
  key="${entry%% *}"
  value="${entry#* }"
  if [[ "$start_case_type" == "$key" ]]; then
    emoji=$value
    break
  fi
done

# ìœ íš¨í•˜ì§€ ì•Šì€ íƒ€ìž…ì´ë©´ ì»¤ë°‹ì„ ë§‰ê³  ê°€ì´ë“œë¥¼ ì¶œë ¥
if [[ -z "$emoji" ]]; then
  echo "â›” ì˜¬ë°”ë¥´ì§€ ì•Šì€ ì»¤ë°‹ íƒ€ìž…ìž…ë‹ˆë‹¤."
  echo "   ì‚¬ìš© ê°€ëŠ¥í•œ íƒ€ìž…: Feat, Fix, Style, Refactor, File, Test, Docs, Remove, Ci, Release, Chore"
  echo "   ì˜ˆ) Feat: ê¸°ëŠ¥ ì¶”ê°€ ì„¤ëª…"
  exit 1
fi

# ì²« ë²ˆì§¸ ë‹¨ì–´ë¥¼ 'ì´ëª¨ì§€ + íƒ€ìž…(ëŒ€ì†Œë¬¸ìž ì •ë¦¬)' ë¡œ ë³€í™˜
first_line=$(echo "$first_line" | sed "s/^$type/$emoji $start_case_type/")

# (ì„ íƒ) ë¸Œëžœì¹˜ ì´ë¦„ì´ í•„ìš”í•˜ë©´ ì•„ëž˜ ë³€ìˆ˜ ì‚¬ìš© ê°€ëŠ¥
branch_name=$(git rev-parse --abbrev-ref HEAD)
# í˜„ìž¬ ì˜ˆì‹œëŠ” branch_name ì€ ì‚¬ìš©í•˜ì§€ ì•Šê³ , í•„ìš”ì‹œ ê·œì¹™ í™•ìž¥ì— í™œìš©.

echo "$first_line" > "$COMMIT_MESSAGE_FILE_PATH"
echo "$remaining_lines" >> "$COMMIT_MESSAGE_FILE_PATH"

